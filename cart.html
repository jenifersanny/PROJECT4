<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - YUFUNANEC PNG Heritage Garments Store</title>
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body data-page="cart">
    <div id="alertContainer"></div>
    
    <header class="header">
        <div class="nav-container">
            <a href="/home.html" class="logo">YUFUNANEC</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="/home.html">Home</a></li>
                    <li><a href="/shop.html">Shop</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/contact.html">Contact</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <span id="userInfo"></span>
                <button id="logoutBtn" class="btn btn-secondary">Logout</button>
                <a href="/cart.html" class="cart-icon">
                    ðŸ›’
                    <span id="cartCount" class="cart-count">0</span>
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <h1>Shopping Cart</h1>
        
        <div id="cartContent">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <div id="emptyCart" style="display: none; text-align: center; padding: 3rem;">
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added any items to your cart yet.</p>
            <a href="/shop.html" class="btn btn-primary">Continue Shopping</a>
        </div>

        <div id="cartItems" style="display: none;">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                <!-- Cart Items -->
                <div>
                    <div id="cartItemsList"></div>
                </div>

                <!-- Cart Summary -->
                <div class="cart-summary">
                    <h3>Order Summary</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span>Subtotal:</span>
                        <span id="cartSubtotal">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span>Shipping:</span>
                        <span>Free</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; font-size: 1.2rem; font-weight: bold; border-top: 2px solid var(--light-brown); padding-top: 1rem;">
                        <span>Total:</span>
                        <span id="cartTotal">$0.00</span>
                    </div>
                    <button id="checkoutBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">Proceed to Checkout</button>
                    <button id="clearCartBtn" class="btn btn-danger" style="width: 100%;">Clear Cart</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>YUFUNANEC</h3>
                <p>Preserving PNG heritage through authentic traditional garments.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="/shop.html">Shop</a>
                <a href="/about.html">About Us</a>
                <a href="/contact.html">Contact</a>
            </div>
            <div class="footer-section">
                <h3>Customer Service</h3>
                <a href="/shipping.html">Shipping Info</a>
                <a href="/returns.html">Returns</a>
                <a href="/faq.html">FAQ</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 YUFUNANEC PNG Heritage Garments Store. All rights reserved.</p>
        </div>
    </footer>

    <script src="/assets/js/main.js"></script>
    <script>
        class CartPage {
            constructor() {
                this.init();
            }

            async init() {
                await this.loadCart();
                this.setupEventListeners();
            }

            async loadCart() {
                const cart = await marketplace.getCart();
                this.renderCart(cart);
            }

            renderCart(cart) {
                const cartContent = document.getElementById('cartContent');
                const emptyCart = document.getElementById('emptyCart');
                const cartItems = document.getElementById('cartItems');
                const cartItemsList = document.getElementById('cartItemsList');
                const cartSubtotal = document.getElementById('cartSubtotal');
                const cartTotal = document.getElementById('cartTotal');

                cartContent.style.display = 'none';

                if (!cart.items || cart.items.length === 0) {
                    emptyCart.style.display = 'block';
                    cartItems.style.display = 'none';
                    return;
                }

                emptyCart.style.display = 'none';
                cartItems.style.display = 'block';

                // Render cart items
                cartItemsList.innerHTML = cart.items.map(item => `
                    <div class="cart-item" data-item-id="${item.id}">
                        <img src="${item.image_url || '/images/placeholder.jpg'}" 
                             alt="${item.name}" class="cart-item-image">
                        <div class="cart-item-info">
                            <h4 class="cart-item-title">${item.name}</h4>
                            <div class="cart-item-details">
                                ${item.size ? `Size: ${item.size}` : ''}
                                ${item.color ? ` | Color: ${item.color}` : ''}
                            </div>
                        </div>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="cartPage.updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                            <input type="number" value="${item.quantity}" min="1" class="quantity-input" 
                                   onchange="cartPage.updateQuantity(${item.id}, this.value)">
                            <button class="quantity-btn" onclick="cartPage.updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                        </div>
                        <div class="cart-item-price">$${(parseFloat(item.price) * item.quantity).toFixed(2)}</div>
                        <button class="btn btn-danger" onclick="cartPage.removeItem(${item.id})">Remove</button>
                    </div>
                `).join('');

                // Update totals
                const total = parseFloat(cart.total || 0);
                cartSubtotal.textContent = `$${total.toFixed(2)}`;
                cartTotal.textContent = `$${total.toFixed(2)}`;
            }

            async updateQuantity(itemId, newQuantity) {
                if (newQuantity < 1) {
                    return this.removeItem(itemId);
                }

                try {
                    const response = await fetch(`/api/cart.php?id=${itemId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ quantity: parseInt(newQuantity) })
                    });

                    if (response.ok) {
                        await this.loadCart();
                        marketplace.loadCartCount();
                    } else {
                        marketplace.showAlert('Failed to update quantity', 'error');
                    }
                } catch (error) {
                    marketplace.showAlert('Failed to update quantity', 'error');
                }
            }

            async removeItem(itemId) {
                if (!confirm('Are you sure you want to remove this item?')) return;

                try {
                    const response = await fetch(`/api/cart.php?id=${itemId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        await this.loadCart();
                        marketplace.loadCartCount();
                        marketplace.showAlert('Item removed from cart', 'success');
                    } else {
                        marketplace.showAlert('Failed to remove item', 'error');
                    }
                } catch (error) {
                    marketplace.showAlert('Failed to remove item', 'error');
                }
            }

            async clearCart() {
                if (!confirm('Are you sure you want to clear your entire cart?')) return;

                try {
                    const response = await fetch('/api/cart.php?action=clear', {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        await this.loadCart();
                        marketplace.loadCartCount();
                        marketplace.showAlert('Cart cleared', 'success');
                    } else {
                        marketplace.showAlert('Failed to clear cart', 'error');
                    }
                } catch (error) {
                    marketplace.showAlert('Failed to clear cart', 'error');
                }
            }

            setupEventListeners() {
                const checkoutBtn = document.getElementById('checkoutBtn');
                const clearCartBtn = document.getElementById('clearCartBtn');

                if (checkoutBtn) {
                    checkoutBtn.addEventListener('click', () => {
                        window.location.href = '/checkout.html';
                    });
                }

                if (clearCartBtn) {
                    clearCartBtn.addEventListener('click', () => {
                        this.clearCart();
                    });
                }
            }
        }

        // Initialize cart page when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.cartPage = new CartPage();
        });
    </script>
</body>
</html>